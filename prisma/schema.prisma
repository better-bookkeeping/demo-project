generator client {
  provider = "prisma-client"
  output   = "./generated/client"
}

datasource db {
  provider = "postgresql"
}

enum MealType {
  BREAKFAST
  LUNCH
  DINNER
  SNACK
}

model User {
  id             String          @id @default(uuid())
  email          String          @unique
  name           String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  passwordHash   String
  weights        Weight[]
  workouts       Workout[]
  movements      Movement[]
  nutritions     Nutrition[]
  nutritionGoal  NutritionGoal?
  goalWeight     Float?
  goalType       String?
  heightFeet     Int?
  heightInches   Int?
}

model Weight {
  id         String   @id @default(uuid())
  userId     String
  user       User     @relation(fields: [userId], references: [id])
  value      Float
  recordedAt DateTime @default(now())

  @@index([userId, recordedAt])
}

model Movement {
  id           String  @id @default(uuid())
  userId       String
  user         User    @relation(fields: [userId], references: [id])
  name         String
  isBodyWeight Boolean @default(false)
  sets         Set[]

  @@index([userId])
}

model Workout {
  userId      String
  user        User      @relation(fields: [userId], references: [id])
  id          String    @id @default(uuid())
  completedAt DateTime?
  sets        Set[]

  @@index([userId, completedAt])
}

model Set {
  id         String   @id @default(uuid())
  workoutId  String
  workout    Workout  @relation(fields: [workoutId], references: [id])
  movementId String
  movement   Movement @relation(fields: [movementId], references: [id])
  reps       Int
  weight     Float

  @@index([workoutId])
  @@index([movementId])
}

model Nutrition {
  id         String   @id @default(uuid())
  userId     String
  user       User     @relation(fields: [userId], references: [id])
  mealType   MealType
  food       String
  calories   Int
  protein    Float?
  carbs      Float?
  fat        Float?
  recordedAt DateTime @default(now())

  @@index([userId, recordedAt])
}

model NutritionGoal {
  userId    String   @id
  user      User     @relation(fields: [userId], references: [id])
  calories  Int
  protein   Float?
  carbs     Float?
  fat       Float?
  updatedAt DateTime @updatedAt

  @@index([userId])
}

model Food {
  id          String   @id @default(uuid())
  name        String
  category    String
  calories    Int
  protein     Float
  carbs       Float
  fat         Float
  servingSize String?
  isCustom    Boolean  @default(false)
  userId      String?

  @@index([name])
  @@index([category])
  @@index([isCustom, userId])
}
